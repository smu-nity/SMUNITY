{% extends 'base.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/mypage.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/register.css' %}">
{% endblock %}

{% block main_area %}
    <div class="navbar-img">
        <img class="navbar-img-image" src="{% static 'img/main.jpg' %}"  style="width: 100%; height: 300px; object-fit:cover"/>
        <div class="navbar-img__text">
            <span class="navbar-img__text--title">
                <div style="font-size:4rem;">
                    <img src="{% static 'img/logo.png' %}" style="width:100px; height:100px;">
                </div>
                <div class="big_title">ë§ˆì´í˜ì´ì§€</div>
            </span>
            <span class="navbar-img__text--subtitle">
                <button onclick="go_result()" class="go_result_btn">ì¡¸ì—…ìš”ê±´ ê²€ì‚¬í•˜ê¸°</button>
            </span>
        </div>
    </div>

    <div class="white_sec">
        <div class="my_box_wrap">
            <div class="my_box">
                <div class="my_box_title">
                    <div><i class="fas fa-user"></i>ë‚´ ì •ë³´</div>
                    <button id='b1' class="my_box_mod_btn">ì—…ë°ì´íŠ¸</button>
                </div>
                <hr>
                <table>
                    <tr>
                        <td class="my_box_table_1st_td">ì´ë¦„</td>
                        <td>{{ profile.name }}</td>
                    </tr>
                    <tr>
                        <td class="my_box_table_1st_td">í•™ë²ˆ</td>
                        <td>201911019</td>
                    </tr>
                    <tr>
                        <td class="my_box_table_1st_td">í•™ê³¼</td>
                        <td>{{ profile.department.name }}</td>
                    </tr>
                    <tr>
                        <td class="my_box_table_1st_td">ê³¼ì‚¬ë¬´ì‹¤<br>ì „í™”ë²ˆí˜¸</td>
                        <td>{{ profile.department.call }}</td>
                    </tr>
                </table>
                <hr style="margin-bottom:0.8rem; margin-top:0.8rem;">
                <div class="my_box_title">
                    <div><i class="fas fa-key"></i>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
                    <button id='b3' class="my_box_mod_btn">ë³€ê²½í•˜ê¸°</button>
                </div>
                <hr style="margin-bottom:0.8rem; margin-top:0.8rem;">
                <div class="my_box_title">
                    <div><i class="fas fa-exclamation-triangle"></i>íšŒì› íƒˆí‡´</div>
                    <button id='b6' class="my_box_mod_btn">íƒˆí‡´í•˜ê¸°</button>
                </div>
            </div>

            <!-- ê¸°ì´ìˆ˜ê³¼ëª© -->
            <div class="my_box_grade">
                <div style="padding:2.5rem 2.5rem 0 2.5rem">
                    <div class="my_box_title">
                        <div><i class="fas fa-graduation-cap"></i>ë‚´ ê¸°ì´ìˆ˜ê³¼ëª©</div>
                        <div>
{#                            <button id='b5' class="my_box_mod_btn" style="margin-right:1.3rem">ì»¤ìŠ¤í…€í•˜ê¸°</button>#}
                            <button id='b4' class="my_box_mod_btn">ì—…ë°ì´íŠ¸</button>
                        </div>
                    </div>
                    <hr>

                    <!-- 7ê°œ -->
                    <table id="short_table" class="grade_table" style="margin-top:2rem;">
                        <tr>
                            <th class="grade_table_th" style="width:10%">ë…„ë„</th>
                            <th class="grade_table_th" style="width:10%">í•™ê¸°</th>
                            <th class="grade_table_th" style="width:14%">í•™ìˆ˜ë²ˆí˜¸</th>
                            <th class="grade_table_th" style="width:30%">ê³¼ëª©ëª…</th>
                            <th class="grade_table_th" style="width:14%">ì´ìˆ˜êµ¬ë¶„</th>
                            <th class="grade_table_th" style="width:14%">ì„ íƒì˜ì—­</th>
                            <th class="grade_table_th" style="width:8%; border-right :0px">í•™ì </th>
                        </tr>
                        {% for course in short %}
                        <tr>
                            <td class="grade_table_td">{{ course.year }}</td>
                            <td class="grade_table_td">{{ course.semester }}</td>
                            <td class="grade_table_td">{{ course.subject.number }}</td>
                            <td class="grade_table_td">{{ course.subject.name }}</td>
                            <td class="grade_table_td">{{ course.type }}</td>
                            <td class="grade_table_td">
                                {% if course.domain  %}
                                    {{ course.domain }}
                                {% endif %}
                            </td>
                            <td class="grade_table_td" style="border-right :0px">{{ course.credit }}</td>
                        </tr>
                        {% endfor %}
                    </table>

                    <!-- ì „ì²´ë³´ê¸° -->
                    <table id="long_table" class="grade_table" style="display:none; ">
                        <tr>
                            <th class="grade_table_th" style="width:10%">ë…„ë„</th>
                            <th class="grade_table_th" style="width:10%">í•™ê¸°</th>
                            <th class="grade_table_th" style="width:14%">í•™ìˆ˜ë²ˆí˜¸</th>
                            <th class="grade_table_th" style="width:30%">ê³¼ëª©ëª…</th>
                            <th class="grade_table_th" style="width:14%">ì´ìˆ˜êµ¬ë¶„</th>
                            <th class="grade_table_th" style="width:14%">ì„ íƒì˜ì—­</th>
                            <th class="grade_table_th" style="width:8%; border-right :0px">í•™ì </th>
                        </tr>
                        {% for course in courses %}
                        <tr>
                            <td class="grade_table_td">{{ course.year }}</td>
                            <td class="grade_table_td">{{ course.semester }}</td>
                            <td class="grade_table_td">{{ course.subject.number }}</td>
                            <td class="grade_table_td">{{ course.subject.name }}</td>
                            <td class="grade_table_td">{{ course.type }}</td>
                            <td class="grade_table_td">
                                {% if course.domain  %}
                                    {{ course.domain }}
                                {% endif %}
                            </td>
                            <td class="grade_table_td" style="border-right :0px">{{ course.credit }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
                <div id="show_btn" onclick="show_table()" class="show_table"><i class="fas fa-chevron-down"></i>&nbsp;í¼ì¹˜ê¸°
                </div>
                <div id="hide_btn" onclick="hide_table()" class="show_table" style="display:none"><i
                        class="fas fa-chevron-up"></i>&nbsp;ì ‘ê¸°</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. ë‚´ì •ë³´ ì—…ë°ì´íŠ¸ ëª¨ë‹¬ -->
    <div id='m1' class="modal">
        <div class="update_modal_content">
            <div id='c1' class="close">&times;</div>
            <div class="login_title" style="font-size:2rem; margin-top:1.7rem;">
                ë‚´ ì •ë³´ ì—…ë°ì´íŠ¸
            </div>
            <div style="margin-top:0.5rem; font-size:0.9rem; color:rgb(199, 199, 199)">
                ì´ìº í¼ìŠ¤ì— ë¡œê·¸ì¸í•˜ì—¬ ì´ë¦„, í•™ê³¼ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (ìƒëª…ëŒ€í•™êµ í¬í„¸ ID/PWì™€ ë™ì¼)
            </div>
            <hr style="width:80%; margin-top:1.3rem;">
            <!-- í¼ -->
            <form action="{% url 'accounts:update' %}" method="post" name='form1' onsubmit="return check_up1()">
                {% csrf_token %}
                <div class="regi_box">
                    <label>í•™ë²ˆ</label>
                    <input type="text" value="{{ user.username }}"
                        style="background-color:rgb(248,249,250);" disabled>
                    <label>ì´ìº í¼ìŠ¤ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="pw" name="password" placeholder="ì´ìº í¼ìŠ¤ ë¹„ë°€ë²ˆí˜¸">
                </div>
                <input type='submit' class='go_result_btn' value='ë¡œê·¸ì¸' style="margin:2.5rem 0 2rem 0;">
            </form>
        </div>
    </div>

    <!-- 3. ë¹„ë²ˆ ë³€ê²½ ëª¨ë‹¬ -->
    <div id='m3' class="modal">
        <div class="update_modal_content">
            <div id='c3' class="close">&times;</div>
            <div class="login_title" style="font-size:2rem; margin-top:1.7rem;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
            <hr style="width:80%; margin-top:1.3rem;">
            <!-- í¼ -->
            <form action="{% url 'accounts:change' %}" method="post" name='form3' onsubmit="return check_up3()">
                {% csrf_token %}
                <div class="regi_box">
                    <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input id="pw1" type="password" name="password1">
                    <label>ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸</label>
                    <input id="pw2" type="password" name="password2">
                </div>
                <input type='submit' class='go_result_btn' value='ë³€ê²½í•˜ê¸°' style="margin:2.5rem 0 2rem 0;">
            </form>
        </div>
    </div>

    <!-- 4. ê¸°ì´ìˆ˜ì„±ì  ì—…ë°ì´íŠ¸ ëª¨ë‹¬-->
    <div id='m4' class="modal">
        <div class="update_modal_content">
            <div id='c4' class="close">&times;</div>
            <div class="login_title" style="font-size:2rem; margin-top:1.7rem;">
                ê¸°ì´ìˆ˜ì„±ì  ì—…ë¡œë“œ
            </div>

            <hr style="width:80%; margin-top:1.3rem;">
            <div style="margin:0 auto; margin-top:1.5rem; margin-bottom:2.5rem; text-align: left; width:65%">
                <p>1. í•™ê³¼ì‚¬ë¬´ì‹¤ì— ì—°ë½í•©ë‹ˆë‹¤.</p>
                <p>&nbsp;&nbsp; - í•™ê³¼ì‚¬ë¬´ì‹¤ ì „í™”ë²ˆí˜¸: <b><a href="tel:{{ profile.department.call }}">{{ profile.department.call }}</a></b> ({{ profile.department.name }})</p>
                <p>2. <b>â€˜ì„±ì ì‚¬í•­ ì—‘ì…€íŒŒì¼â€™</b> ì†¡ë¶€ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.</p>
                <p>3. ë©”ì¼ë¡œ ì†¡ë¶€ëœ <b>â€˜ì„±ì ì‚¬í•­ ì—‘ì…€ íŒŒì¼â€™</b>ì„ ë‹¤ìš´ë¡œë“œí•œ í›„, í•´ë‹¹ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p>
                <p style="margin-top:2rem;><span class="caution_info">â€» ë‹¤ìš´ë¡œë“œë°›ì€ íŒŒì¼ì„ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì—…ë¡œë“œí•´ì•¼í•©ë‹ˆë‹¤.</span></p>
                <p><span class="caution_info">â€» ì €ì¥ ì‹œ ì„±ì  ì¤‘ í•™ì ì´ F ì¸ ê³¼ëª©ì€ ì¸ì •ë˜ì§€ ì•Šê³  ìë™ ì‚­ì œë©ë‹ˆë‹¤.</span></p>
                <p><span class="caution_info">â€» ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•˜ëŠ” ì„±ì ì‚¬í•­ ì—‘ì…€íŒŒì¼ì€ ë”°ë¡œ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span></p>
                <p><span class="caution_info">â€» ìƒ˜ë¬¼ í†µí•©ì •ë³´ì‹œìŠ¤í…œì—ì„œ í•´ë‹¹ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì„ ìˆ˜ ìˆë„ë¡ í˜„ì¬ í˜‘ì˜ ì¤‘ì…ë‹ˆë‹¤.</span></p>
            </div>

            <form action="{% url 'core:course_update' %}" method="post" name='form4' onsubmit="return check_up4()" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="box-file-input">
                    <label>
                        <input id="file_input" type="file" name="excel" class="file-input" accept=".xlsx">
                    </label>
                    <span class="filename">íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>
                </div>
                <input type='submit' class='go_result_btn' value='ì—…ë¡œë“œ' style="margin:2.5rem 0 2rem 0;">
            </form>
        </div>
    </div>

    <!-- 5. ê¸°ì´ìˆ˜ê³¼ëª© ì»¤ìŠ¤í…€ ëª¨ë‹¬-->
{#    <div id='m5' class="modal" style="display:none">#}
{#        <div class="update_modal_content">#}
{#            <div id='c5' class="close">&times;</div>#}
{#            <div class="login_title" style="font-size:2rem; margin-top:1.7rem;">#}
{#                ê¸°ì´ìˆ˜ê³¼ëª© ì»¤ìŠ¤í…€#}
{#            </div>#}
{#            <hr style="width:80%; margin-top:1.3rem;">#}
{#            <div style="margin:1.5rem 0 2.5rem 0;">#}
{#                <p>í•™ì‚¬ì •ë³´ì‹œìŠ¤í…œì—ì„œ ë‹¤ìš´ë°›ëŠ” ì—‘ì…€íŒŒì¼ì—” ì´ë²ˆ í•™ê¸° ê³¼ëª©ë“¤ì´ ë°˜ì˜ë˜ì§€ ì•Šìœ¼ì…¨ì£ ? ğŸ˜­</p>#}
{#                <p>ë˜ ë‹¤ìŒ í•™ê¸°ì— ë“¤ì„ ê³¼ëª©ì„ ì¶”ê°€í•´ ê²€ì‚¬í•´ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? </p>#}
{#                <p style="font-size :1.3rem; margin-top:2rem;">#}
{#                    <span style="font-size :1.5rem; font-weight: bold; color : rgb(164, 26, 55)">'ì»¤ìŠ¤í…€ ê¸°ëŠ¥'</span> ìœ¼ë¡œ ì›í•˜ëŠ” ê³¼ëª©ì„ ì¶”ê°€í•´ì„œ ê²€ì‚¬í•´ë³´ì„¸ìš”!#}
{#                </p>#}
{#            </div>#}
{#            <button onclick=location.href="{% url 'core:custom' %}" class='login_btn' style="margin:1rem 0 2rem 0;">ì»¤ìŠ¤í…€ ì‹œì‘</button>#}
{#        </div>#}
{#    </div>#}

    <!-- 6. íšŒì›íƒˆí‡´ ëª¨ë‹¬-->
    <div id='m6' class="modal">
        <div class="update_modal_content">
            <div id='c6' class="close">&times;</div>
            <div class="login_title" style="font-size:2rem; margin-top:1.7rem;">
                íšŒì› íƒˆí‡´
            </div>
            <div style="margin-top:0.5rem; font-size:0.9rem; color:rgb(199, 199, 199)">
                ìŠ¤ë®¤ë‹ˆí‹°ì—ì„œ íƒˆí‡´í•©ë‹ˆë‹¤. (íšŒì› ì •ë³´ ëª¨ë‘ ì‚­ì œ)
            </div>
            <hr style="width:80%; margin-top:1.3rem;">

            <form action="{% url 'core:member_del' %}" method="POST" name='form6' onsubmit="return check_up6()">
                {% csrf_token %}
                <div class="regi_box">
                    <label>í•™ë²ˆ</label>
                    <input type="text" name="student_id" placeholder='{{ user.username }}'
                        style="background-color:rgb(248,249,250);" disabled>
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="pw6" name="pw_del" placeholder="ë¹„ë°€ë²ˆí˜¸">
                </div>
                <input type='submit' class='go_result_btn' value='íƒˆí‡´í•˜ê¸°' style="margin:2.5rem 0 2rem 0;">
            </form>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ì‹œ ë¡œë”© ëª¨ë‹¬ ì°½ -->
    <div id='load_madal' class="modal">
        <div class="load-modal-content">
            <div class="modal_loadcontainer">
                <div class="sk-chase">
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                    <div class="sk-chase-dot"></div>
                </div>
                <div class="loading">
                    <span>ì •</span>
                    <span>ë³´</span>
                    <span>ì—…</span>
                    <span>ë°</span>
                    <span>ì´</span>
                    <span>íŠ¸</span>
                    <span>ì¤‘</span>
                    <span>.</span>
                    <span>.</span>
                    <span>.</span>
                </div>
                <div class="load_info">
                    ì°½ì„ ì´ë™í•˜ì§€ ë§ˆì„¸ìš”!
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
<script src="{% static 'js/modal.js' %}"></script>

<script>
    // ë§ˆì´í˜ì´ì§€ì—ì„œ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ì‹œ ë¬´ì¡°ê±´ home
    history.pushState(null, null, location.href);
    window.onpopstate = function (event) {
        location.href = "{% url 'home' %}";
    };

    // ì¡¸ì—…ìš”ê±´ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
    function go_result() {
        {% if courses %}
            location.href = "{% url 'core:result' %}";
        {% else %}
            alert('ì„±ì ì‚¬í•­ ì—‘ì…€íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”!');
        {% endif %}
    }

    // ì—…ë°ì´íŠ¸ í´ë¦­ì‹œ ë¡œë”© ëª¨ë‹¬ ë„ìš°ê¸°
    function pop_modal() {
        document.getElementById('load_madal').style.display = "block";
    }

    function check_up1() {
        if (!document.getElementById('pw').value) {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            form1.pw.focus();
            return false;
        }
        pop_modal();
        return true;
    }

    function check_up6() {
        if (!document.getElementById('pw6').value) {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            form6.pw6.focus();
            return false;
        }
        var con = confirm('ğŸ˜¢ì •ë§ íƒˆí‡´í•˜ì‹¤ê±´ê°€ìš”?')
        if(con){
            pop_modal();
            return true;
        }
        else{
            return false;
        }
    }


    // ë¹„ë²ˆ ì•ˆì“°ê±°ë‚˜ ì¼ì¹˜ì•ˆí•˜ë©´ ë¹ ê¾¸
    function check_up3() {
        if (!document.getElementById('pw1').value) {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            form3.pw1.focus();
            return false;
        }
        if (document.getElementById('pw1').value !== document.getElementById('pw2').value) {
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            form3.pw1.focus();
            return false;
        }
        pop_modal();
        return true;
    }

    // íŒŒì¼ ì—…ë¡œë“œ ì•ˆí•˜ê³  ë²„íŠ¼ ëˆ„ë¥´ë©´ ë¹ ê¾¸
    function check_up4() {
        if (!document.getElementById("file_input").value) {
            alert("ì—‘ì…€íŒŒì¼ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.");
            return false;
        }
        pop_modal();
        return true;
    }

    // íŒŒì¼ ì—…ë¡œë“œ css - jquery ì ìš©
    $(document).on("change", ".file-input", function () {
        $filename = $('input[type=file]').val().replace(/.*(\/|\\)/, '');
        if ($filename == "")
            $filename = "íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
        $(".filename").text($filename);
    })

    function show_table() {
        // í…Œì´ë¸” ì „í™˜
        document.getElementById("short_table").style.display = "none";
        document.getElementById("long_table").style.display = "table";
        // ë²„íŠ¼ ì „í™˜
        document.getElementById("show_btn").style.display = "none";
        document.getElementById("hide_btn").style.display = "block";
    }

    function hide_table() {
        document.getElementById("short_table").style.display = "table";
        document.getElementById("long_table").style.display = "none";
        document.getElementById("show_btn").style.display = "block";
        document.getElementById("hide_btn").style.display = "none";
    }

    // ëª¨ë‹¬ ì¼œëŠ” ë²„íŠ¼ id
    var b1 = document.getElementById("b1");     // 1. ë‚´ ì •ë³´ ì—…ë°ì´íŠ¸
    var b3 = document.getElementById("b3");     // 3. ë¹„ë²ˆ ë³€ê²½
    var b4 = document.getElementById("b4");     // 4. ê¸°ì´ìˆ˜ì„±ì  ì—…ë¡œë“œ
    {#var b5 = document.getElementById("b5");     // 5. ì»¤ìŠ¤í…€#}
    var b6 = document.getElementById("b6");     // 6. íšŒì›íƒˆí‡´

    // ëª¨ë‹¬ id
    var m1 = document.getElementById('m1');
    var m3 = document.getElementById('m3');
    var m4 = document.getElementById('m4');
    var m5 = document.getElementById('m5');
    var m6 = document.getElementById('m6');

    // ëª¨ë‹¬ ë„ëŠ” ë²„íŠ¼(X) id
    var c1 = document.getElementById("c1");
    var c2 = document.getElementById("c2");
    var c3 = document.getElementById("c3");
    var c4 = document.getElementById("c4");
    {#var c5 = document.getElementById("c5");#}
    var c6 = document.getElementById("c6");

    // ëª¨ë‹¬ í‚¤ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
    Btnclick(b1, m1);
    Btnclick(b3, m3);
    Btnclick(b4, m4);
    {#Btnclick(b5, m5);#}
    Btnclick(b6, m6);
    // ëª¨ë‹¬ ë„ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
    Spanclick(c1, m1);
    Spanclick(c3, m3);
    Spanclick(c4, m4);
    {#Spanclick(c5, m5);#}
    Spanclick(c6, m6);
    // ëª¨ë‹¬ ë°– í™”ë©´ ëˆ„ë¥¼ë•Œ êº¼ì§€ê²Œí•˜ê¸°
    window.onclick = function (event) {
        if (event.target == m1) {
            m1.style.display = "none";
        }
        if (event.target == m3) {
            m3.style.display = "none";
        }
        if (event.target == m4) {
            m4.style.display = "none";
        }
        if (event.target == m5) {
            m5.style.display = "none";
        }
        if (event.target == m6) {
            m6.style.display = "none";
        }
    }

    // íˆ´íŒ í•¨ìˆ˜
    let tooltip_btn = document.querySelectorAll('.tooltip');
    let tooltip_box = document.querySelectorAll('.tooltip_text2');
    window.onload = function(){

        for (i = 0; i < tooltip_btn.length; i++) {
            Tooltipeb(tooltip_btn[i], tooltip_box[i]);
        }

        function Tooltipeb(btn, box) {
            btn.addEventListener('click', () => {
                box.classList.toggle('active');
            });
        }
    }
    </script>
{% endblock %}